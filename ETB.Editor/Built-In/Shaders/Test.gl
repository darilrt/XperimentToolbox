uniform mat4 XTB_MATRIX_VP; // View * Projection Matrix
uniform mat4 XTB_MATRIX_M;  // Model View Matrix

#define UNIFORM(T, A) \
	uniform T A; \
	uniform bool xtb_##A##_isSet = false;

#define ISSET(A) xtb_##A##_isSet

UNIFORM(sampler2D, albedo);

varying vec2 uvMainTex;
varying vec4 vertexPosition;
varying vec3 worldNormal;

#ifdef ETB_VERTEX_SHADER

layout (location = 0) in vec3 _vertexPosition;
layout (location = 1) in vec2 _uvMainTex;
layout (location = 2) in vec3 _vertexNormal;

void main() {
	uvMainTex = _uvMainTex;
	worldNormal = (XTB_MATRIX_M * vec4(normalize(_vertexNormal), 1.0)).xyz;
	vertexPosition = XTB_MATRIX_M * vec4(_vertexPosition, 1);
	
	gl_Position = XTB_MATRIX_VP * vertexPosition;
}

#endif
#ifdef ETB_FRAGMENT_SHADER

layout (location = 0) out vec4 _fragColor;

vec3 lightPos = vec3(-3, 2.5f, 2);
vec3 lightColor = vec3(1, 1, 1);

void main() {
	vec3 objectColor;
	
	if (ISSET(albedo)) {
		objectColor = texture(albedo, uvMainTex).rgb;
	}
	else {
		objectColor = vec3(1.0, 1.0, 1.0);
	}
	
	// ambient
    float ambientstrength = 0.1;
    vec3 ambient = ambientstrength * lightColor;
	
	// diffuse
	vec3 norm = normalize(worldNormal);
	vec3 lightdir = normalize(lightPos);
	
	float diff = max(dot(norm, lightdir), 0.0);
	vec3 diffuse = diff * lightColor;
	
    vec3 result = (ambient + diffuse) * objectColor;
	
	_fragColor = vec4(objectColor, 1.0);
}

#endif